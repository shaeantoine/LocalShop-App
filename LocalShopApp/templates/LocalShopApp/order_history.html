{% extends 'LocalShopApp/main.html' %}
{% load static %}
{% block content %}
<div class="row">
	<div class="col-lg-12">
		<div class="box-element">
            <a class="btn btn-outline-dark" href="{% url 'localshop' %}">&#x2190; Continue Shopping</a>
            <br>
            <br>
            <h3>Order History</h3>
            <table class="table">
                <tr>
                    <th><h5>Order ID</h5></th>
                    <th><h5>Date</h5></th>
                    <th><h5>Total</h5></th>
                    <th><h5>Status</h5></th>
                    <th><h5>Details</h5></th>
                </tr>
                {% for order in orders %}
                <tr>
                    <td>{{ order.id }}</td>
                    <td>{{ order.date_ordered }}</td>
                    <td>${{ order.get_cart_total|floatformat:2 }}</td>
                    <td>{{ order.status }}</td>
                    <td>
                        <button class="btn btn-info toggle-details-btn" data-order-id="{{ order.id }}">Show Details</button>
                    </td>
                </tr>
                <tr class="order-details" id="order-details-{{ order.id }}" style="display: none;">
                    <td colspan="4">
                        <div class="cart-row">
                            <div style="flex:2"><strong>Order Items</strong></div>
                            <div style="flex:1"><strong>Price</strong></div>
                            <div style="flex:1"><strong>Quantity</strong></div>
                        </div>
                        {% for item in order_items %}
                            {% if item.order.id == order.id %}
                            <div class="cart-row">
                                <div style="flex:2"><p>{{ item.product.name }}</p></div>
                                <div style="flex:1"><p>${{ item.product.price|floatformat:2 }}</p></div>
                                <div style="flex:1"><p>{{ item.quantity }}</p></div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // JavaScript/jQuery code to toggle order details visibility
    $(document).ready(function(){
        $(".toggle-details-btn").click(function(){
            var orderId = $(this).data("order-id");
            $("#order-details-" + orderId).toggle();
        });
    });
</script>
{% endblock content %}
